window.onload=function(){var e=function(e,s,a){this.marker=e,this.name=s,this.vicinity=a},s=function(){function s(e,s){if(s==google.maps.places.PlacesServiceStatus.OK)for(var n=0;n<e.length;n++)a.createMarker(e[n])}var a=this;a.toggleImage=ko.observable("images/arrow_down.png"),a.placesList=ko.observableArray(),a.searchResults=ko.observableArray(),a.searchResults_isVisible=ko.observable(!1),a.searchterm=ko.observable();var n={center:{lat:39.781121,lng:-89.649889},zoom:13,disableDefaultUI:!0};try{var t=new google.maps.Map(document.getElementById("map-canvas"),n),o="fe7569",r=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|"+o,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),i="930d01",l=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|"+i,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),c={location:{lat:39.7811121,lng:-89.649889},radius:"5000",types:["restaurant"]},g=new google.maps.InfoWindow,m=new google.maps.places.PlacesService(t);m.nearbySearch(c,s)}catch(p){for(var u=document.getElementsByClassName("search"),h=0;h<u.length;h++)u[h].style.display="none";for(u=document.getElementsByClassName("search_results"),h=0;h<u.length;h++)u[h].style.display="none";for(u=document.getElementsByClassName("map_err"),h=0;h<u.length;h++)u[h].style.display="block"}a.createMarker=function(s){var n=new google.maps.Marker({map:t,position:s.geometry.location,icon:r});google.maps.event.addListener(n,"click",function(){a.resetMarkerIcons(),n.setIcon(l),a.getLocationInfo(n,s)}),a.placesList.push(new e(n,s.name,s.vicinity)),a.searchResults.push(new e(n,s.name,s.vicinity))},a.getLocationInfo=function(e,s){var a=s.geometry.location.lat(),n=s.geometry.location.lng();$.ajax({url:"https://api.foursquare.com/v2/venues/search?v=20150402&client_id=O3HOXE5ZEZ05NEMSCBSV0MQHIQQWN2IKMGTQFGEXY2AY1T0S&client_secret=RVEJ4YKJXVZ3I3KPLJWAXYMLAYRIIDJIOVEQHXXZZL2CW4RG&intent=match&limit=1&ll="+a+","+n+"&llAcc=500&query="+s.name,dataType:"json",success:function(a){var n="";a.response.venues[0]?(n='<img width="15" src="'+s.icon+'"/> ',n+=a.response.venues[0].name,n=n+' <a href="https://foursquare.com/v/'+a.response.venues[0].name+"/"+a.response.venues[0].id+'?ref=O3HOXE5ZEZ05NEMSCBSV0MQHIQQWN2IKMGTQFGEXY2AY1T0S" target="_blank"><img width="15" src="images/foursquare-icon-16x16.png"></a><br/>',n=n+a.response.venues[0].location.address+"<br/>",n=n+a.response.venues[0].contact.formattedPhone+"<br/>",a.response.venues[0].hasMenu===!0&&(n=n+'<a href="'+a.response.venues[0].menu.url+'" target="_blank">View Menu</a><br/>')):n='<img width="15" src="'+s.icon+'"/> '+s.name+"<br/>",g.setContent(n),g.open(t,e)},failure:function(){g.setContent('<img width="15" src="'+s.icon+'"/> '+s.name),g.open(t,e)},error:function(){g.setContent('<img width="15" src="'+s.icon+'"/> '+s.name),g.open(t,e)}})},a.searchMarkers=function(){var e=new RegExp(a.searchterm(),"gi"),s=[];for(var n in a.placesList())a.placesList()[n].name.match(e)?(a.placesList()[n].marker.setMap(t),s.push(a.placesList()[n])):a.placesList()[n].marker.setMap(null);a.searchResults(s)},a.resetMarkerIcons=function(){for(var e in a.placesList())a.placesList().hasOwnProperty(e)&&a.placesList()[e].marker.setIcon(r)},a.toggleResults=function(){a.searchResults_isVisible()===!0?(a.searchResults_isVisible(!1),a.toggleImage("images/arrow_down.png")):(a.searchResults_isVisible(!0),a.toggleImage("images/arrow_up.png"))},a.selectSearchResult=function(e){google.maps.event.trigger(e.marker,"click"),t.setCenter(e.marker.position),a.toggleResults()}};ko.applyBindings(new s)};